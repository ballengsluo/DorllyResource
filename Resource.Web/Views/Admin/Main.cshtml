@{
    Layout = null;
}
@helper res()
{
    <div class="col-lg-6 col-md-6 col-sm-6">
        <h4>业务概览</h4>
        <div class="col-lg-12 col-md-12 col-sm-12" style="padding-left:0px;background-color: #fff;border:1px solid #ccc;border-bottom:none;">
            <div class="col-lg-2 col-md-2 col-sm-2" style="padding:10px 10px 10px 5px;">
                <div class="input-group">
                    <span class="input-group-addon">园区</span>
                    @{ Html.RenderAction("ParkDrop", "Drop", new { pid = "", id = "", model = 1 });}
                </div>
            </div>
        </div>
        <div id="resource">
            @Html.Partial("_Resource")
        </div>
       
    </div>
}
<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>我的工作台</title>
    @Styles.Render("~/Plugins/layui/css/layui.css")
    @Styles.Render("~/Plugins/bootstrap/css/bootstrap.min.css")
    @Styles.Render("~/Plugins/font-awesome/css/font-awesome.min.css")
    @Styles.Render("~/Plugins/bootstrap-select/css/bootstrap-select.min.css")
    <style>
        body {
            background-color: #f9f9f9;
        }
       .container-fluid{
           width:90%;
       }
        h4 {
            padding: 10px 0px;
            text-align: center;
            font-weight: 600;
            font-size: 18px;
        }

        table tr td, table tr th {
            text-align: center;
        }

        .res {
            border: 1px solid #ccc;
            background-color: #fff;
        }

        .reskind {
            padding: 10px 0px;
            font-weight: 600;
            border-bottom: 1px solid #ccc;
        }

        #rm {
            border-right: none;
        }

        .rmcount > td {
            font-weight: 600;
            color: blue;
        }

        .res tr:first-of-type td {
            border-top: none;
        }

        #cb, #mr {
            border-bottom: none;
        }

        .msg {
            border: 1px solid #ccc;
            height: 342px;
            background-color: #fff;
        }

        /* 趋势分析图样式*/

        /*头部*/
        .orderdata {
            width: 90%;
            margin: 0 auto;
        }
        .orderdata>div{
            width:100%;
            float:left;
        }

            .orderdata .header {
                position: relative;
                height: 54px;
            }

                .orderdata .header > div {
                    margin: 10px;
                    font-size: 16px;
                    height: 34px;
                    line-height: 34px;
                }

                .orderdata .header .header-title {
                    float: left;
                }

                .orderdata .header .header-search {
                    float: right;
                }

            .orderdata .header-search > div {
                float: left;
            }
            /*
                    平面样式
                */
            .orderdata .content > div {
                width: 50%;
                float: left;
            }

            .orderdata .content .content-panel > div {
                width: 40%;
                float: left;
                height: 130px;
                text-align: center;
                margin: 1%;
            }

                .orderdata .content .content-panel > div:last-of-type {
                    width: 82%;
                }

            .orderdata .content .content-panel div > div:first-of-type {
                height: 60%;
                line-height: 90px;
                font-size: 35px;
                color: blue;
            }

            .orderdata .content .content-panel div > div:last-of-type {
                height: 40%;
                font-size: 16px;
            }


            /*图表样式*/
            .orderdata .content .content-graph {
                /*height: 425px;*/
                height: 460px;
            }

        #search {
            font-size: 15px;
            margin-left: 10px;
            height: 34px;
            vertical-align: inherit;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        @*@Html.Partial("_BusinessData")*@
        @if (ViewBag.func != null && ViewBag.func.Count > 0)
        {
            var func = ViewBag.func as List<T_MenuFunc>;
            if (func.Where(a => a.Code == "resource").Count() > 0)
            {
                @res()
            }
            if (func.Where(a => a.Code == "transaction").Count() > 0)
            {
                Html.RenderPartial("_Transaction");
            }
            if (func.Where(a => a.Code == "order").Count() > 0)
            {
                Html.RenderPartial("_Order");
            }
        }

    </div>

    @Scripts.Render("~/Plugins/jquery/jquery-2.2.4.js")
    @Scripts.Render("~/Plugins/bootstrap/js/bootstrap.min.js")
    @Scripts.Render("~/Plugins/layui/layui.js")
    @Scripts.Render("~/Plugins/bootstrap-select/js/bootstrap-select.min.js")
    @Scripts.Render("~/Plugins/echarts/echarts.common.min.js")
    <script>
        var layer;
        $(function () {
            initResourceData();
            initOrderData();
        });

        function initResourceData() {
            $("#rm").height($("#ad").outerHeight() + $("#cb").outerHeight() + $("#mr").outerHeight() - 1);
            //$("#park").val("@ViewBag.park");
            $("#park").change(function () {
                $.get("/Admin/GetResourceData", { park: $(this).val() }, function (data) {
                    $("#resource").html(data);
                    $("#rm").height($("#ad").outerHeight() + $("#cb").outerHeight() + $("#mr").outerHeight() - 1);
                });
            });
            $("#park option:first").attr("selected", true).trigger("change");
        }

        function initOrderData() {
            if ($("#content-graph").length > 0) {
                graph();
                if ($("#stime").length > 0) {
                    layui.use('laydate', function () {
                        var laydate = layui.laydate;
                        laydate.render({
                            elem: '#stime'
                        });
                    });
                }
                if ($("#etime").length > 0) {
                    layui.use('laydate', function () {
                        var laydate = layui.laydate;
                        laydate.render({
                            elem: '#etime'
                        });
                    });
                }
                $("#search").click(function () {
                    graph();
                });
            }
        }
        function graph() {
            $.getJSON("/Admin/GetOrderData", { stime: $("#stime").val(), etime: $("#etime").val() }, function (data) {
                console.log(data);
                var title = new Array();
                var count = new Array();
                $.each(data, function (idx, item) {
                    $("[data-kind='" + item.RID + "']").html(item.RCount);
                    title.push(item.RName);
                    count.push(item.RCount);
                });
                graphData(title, count);
            });
        }
        function graphData(title, count) {
            // 基于准备好的dom，初始化echarts实例
            var myChart = echarts.init(document.getElementById('content-graph'));

            // 指定图表的配置项和数据
            var option = {
                color: ['blue'],
                title: {
                    text: ''
                },
                tooltip: {},
                legend: {
                    data: ['销量']
                },
                xAxis: {
                    //data: ["衬衫", "羊毛衫", "雪纺衫", "裤子", "高跟鞋", "袜子"]
                    data: title
                },
                yAxis: {},
                series: [{
                    //name: '销量',
                    type: 'bar',
                    //data: [5, 20, 36, 10, 10, 20]
                    data: count
                }]
            };
            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);
        }
    </script>
</body>
</html>
